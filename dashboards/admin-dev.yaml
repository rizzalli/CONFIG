# Admin & Development Dashboard
# Quick access to system controls, git sync, and development tools

title: Admin & Dev
views:
  - title: System Control
    path: admin
    icon: mdi:tools
    badges:
      - entity: sensor.system_monitor_processor_use
      - entity: sensor.system_monitor_memory_usage
      - entity: sensor.system_monitor_disk_usage
    cards:
      # Quick Actions
      - type: entities
        title: üîß System Actions
        show_header_toggle: false
        state_color: true
        entities:
          - type: button
            name: Git Sync (Pull & Push)
            icon: mdi:git
            action_name: Run
            tap_action:
              action: call-service
              service: shell_command.git_sync
              confirmation:
                text: This will sync your config with GitHub. Continue?

          - type: button
            name: System Maintenance
            icon: mdi:wrench
            action_name: Run
            tap_action:
              action: call-service
              service: shell_command.ha_maintenance
              confirmation:
                text: Run maintenance script?

          - type: button
            name: Restart Home Assistant
            icon: mdi:restart
            action_name: Restart
            tap_action:
              action: call-service
              service: homeassistant.restart
              confirmation:
                text: Are you sure you want to restart Home Assistant?

          - type: button
            name: Reload Automations
            icon: mdi:autorenew
            action_name: Reload
            tap_action:
              action: call-service
              service: automation.reload

          - type: button
            name: Reload Scripts
            icon: mdi:script-text
            action_name: Reload
            tap_action:
              action: call-service
              service: script.reload

          - type: button
            name: Reload Templates
            icon: mdi:file-code
            action_name: Reload
            tap_action:
              action: call-service
              service: template.reload

          - type: button
            name: Backup Now
            icon: mdi:cloud-upload
            action_name: Create
            tap_action:
              action: call-service
              service: backup.create
              data:
                name: "Manual backup {{ now().strftime('%Y-%m-%d %H:%M') }}"

          - type: button
            name: Check Configuration
            icon: mdi:check-decagram
            action_name: Check
            tap_action:
              action: call-service
              service: homeassistant.check_config

      # Git Status Info (if you add git sensor)
      - type: markdown
        title: üìã Git Info
        content: |
          **Branch:** main
          **Last Sync:** Check automation history
          
          **Quick Git Commands:**
          - Use "Git Sync" button above to pull/push
          - Auto-sync runs on HA start & nightly at 2 AM

      # Recorder Maintenance
      - type: entities
        title: üóÑÔ∏è Recorder Maintenance
        show_header_toggle: false
        entities:
          - type: button
            name: Purge (30 days) + Repack
            icon: mdi:calendar-30
            action_name: Run
            tap_action:
              action: call-service
              service: recorder.purge
              data:
                keep_days: 30
                repack: true
            confirmation:
              text: This purges ALL history older than 30 days. Continue?

          - type: button
            name: Purge (90 days) + Repack
            icon: mdi:calendar
            action_name: Run
            tap_action:
              action: call-service
              service: recorder.purge
              data:
                keep_days: 90
                repack: true

          - type: button
            name: Purge (180 days) + Repack
            icon: mdi:calendar
            action_name: Run
            tap_action:
              action: call-service
              service: recorder.purge
              data:
                keep_days: 180
                repack: true

          - type: button
            name: Purge (365 days) + Repack
            icon: mdi:calendar
            action_name: Run
            tap_action:
              action: call-service
              service: recorder.purge
              data:
                keep_days: 365
                repack: true
      - type: markdown
        content: |
          Note: Home Assistant doesn't support different retention by domain.
          Use rolling 30-day usage sensors (added) for lights/fans while keeping 365 days globally.

      # Current Automations Status
      - type: entities
        title: ü§ñ Automation Status
        show_header_toggle: false
        entities:
          - entity: automation.derryn_leaves
            name: Derryn Leaves Home
            secondary_info: last-triggered
          - entity: automation.new_automation
            name: Derryn Returns Home
            secondary_info: last-triggered
          - entity: automation.light_sequence
            name: Light Sequence
            secondary_info: last-triggered
          - entity: automation.git_auto_sync_on_ha_start
            name: Git Sync on Start
            secondary_info: last-triggered
          - entity: automation.git_auto_sync_nightly_02_00
            name: Git Sync Nightly
            secondary_info: last-triggered

      # Timers
      - type: entities
        title: ‚è±Ô∏è Active Timers
        show_header_toggle: false
        entities:
          - entity: timer.purifier_auto_timer
            name: Purifier Auto-off Timer

      # System Info
      - type: entities
        title: üíª System Info
        show_header_toggle: false
        entities:
          - entity: sensor.system_monitor_processor_use
            name: CPU Usage
          - entity: sensor.system_monitor_memory_usage
            name: Memory Usage
          - entity: sensor.system_monitor_disk_usage
            name: Disk Usage
          - entity: sensor.system_monitor_last_boot
            name: Raspberry Pi Last Boot


      # Live Log - removed (file sensor deprecated)
      # To see logs, use: Settings ‚Üí System ‚Üí Logs

      # Database Info
      - type: markdown
        title: üóÑÔ∏è Database
        content: |
          **Type:** MariaDB (configured)
          **Recorder:** Active
          
          Database size and purge info available in System Settings.

      # HACS Status (removed - entity not found)

  # Development/Testing View
  - title: Testing
    path: testing
    icon: mdi:test-tube
    cards:
      # Daily Health Summary
      - type: vertical-stack
        cards:
          - type: entities
            title: ‚úÖ Daily Health Summary
            entities:
              - entity: sensor.unavailable_entities
                name: Unavailable Entities
              - entity: sensor.automations_off
                name: Automations Off
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.system_monitor_processor_use
                name: CPU
                min: 0
                max: 100
              - type: gauge
                entity: sensor.system_monitor_memory_usage
                name: Memory
                min: 0
                max: 100
              - type: gauge
                entity: sensor.system_monitor_disk_usage
                name: Disk
                min: 0
                max: 100
      # Dashboard Testing
      - type: markdown
        title: üß™ Dashboard Testing
        content: |
          **Active Test Dashboards:**
          - [Minimalist](#/lovelace-minimalist/home)
          - [Card Based](#/lovelace-cards/home)
          - [Functional](#/lovelace-functional/home)
          
          Take notes on what you like/dislike!

      # Test All Lights
      - type: entities
        title: üí° Light Testing
        show_header_toggle: false
        entities:
          - type: button
            name: Test All Lights ON
            icon: mdi:lightbulb-on
            action_name: Test
            tap_action:
              action: call-service
              service: light.turn_on
              service_data:
                entity_id: light.all_lights
                brightness_pct: 100

          - type: button
            name: Test Light Sequence
            icon: mdi:lightbulb-multiple
            action_name: Test

          - type: button
            name: All Lights OFF
            icon: mdi:lightbulb-off
            action_name: Off
            tap_action:
              action: call-service
              service: light.turn_off
              service_data:
                entity_id: light.all_lights

      # Test Individual Rooms
      - type: grid
        title: Test by Room
        columns: 2
        cards:
          - type: button
            name: Kitchen ON
            icon: mdi:silverware-fork-knife
            tap_action:
              action: call-service
              service: light.turn_on
              service_data:
                entity_id:
                  - light.kitchen_bench
                  - light.kitchen_strip

          - type: button
            name: Living Room ON
            icon: mdi:sofa
            tap_action:
              action: call-service
              service: light.turn_on
              service_data:
                entity_id:
                  - light.floor_lamp
                  - light.tv_light

          - type: button
            name: Bedroom ON
            icon: mdi:bed
            tap_action:
              action: call-service
              service: light.turn_on
              service_data:
                entity_id: light.bedroom

          - type: button
            name: All OFF
            icon: mdi:lightbulb-off
            tap_action:
              action: call-service
              service: light.turn_off
              service_data:
                entity_id: light.all_lights

      # Climate Testing
      - type: entities
        title: üå°Ô∏è Climate Testing
        entities:
          - entity: climate.living_room_air_conditioner
          - entity: sensor.living_room_temp
          - entity: sensor.living_room_humidity
          - type: section
            label: Calibration Settings
          - entity: number.living_room_air_conditioner_temperature_calibration
            name: Temperature Calibration
          - entity: number.living_room_air_conditioner_humidity_calibration
            name: Humidity Calibration

      # Air Purifier Testing
      - type: entities
        title: üí® Air Purifier Testing
        entities:
          - entity: fan.living_room_air_purifier
          - type: button
            name: Set Auto Mode
            icon: mdi:fan-auto
            action_name: Set
            tap_action:
              action: call-service
              service: fan.set_preset_mode
              service_data:
                entity_id: fan.living_room_air_purifier
                preset_mode: auto

          - type: conditional
            conditions:
              - condition: state
                entity: fan.living_room_air_purifier
                state_not: auto
                attribute: preset_mode
            row:
              type: button
              name: Set 100% Speed
              icon: mdi:fan-speed-3
              action_name: Set
              tap_action:
                action: call-service
                service: fan.set_percentage
                service_data:
                  entity_id: fan.living_room_air_purifier
                  percentage: 100

      # Entity Browser
      - type: markdown
        title: üîç Quick Links
        content: |
          **Development Tools:**
          - [Developer Tools ‚Üí States](/developer-tools/state)
          - [Developer Tools ‚Üí Services](/developer-tools/service)
          - [System Logs](/config/logs)
          - [System Info](/config/info)
          - [HACS](/hacs)
          
          **Settings:**
          - [Automations](/config/automation/dashboard)
          - [Scripts](/config/script/dashboard)
          - [Scenes](/config/scene/dashboard)
          - [Dashboards](/config/lovelace/dashboards)

  # Logs & Diagnostics
  - title: Logs
    path: logs
    icon: mdi:math-log
    cards:
      - type: markdown
        title: üìú System Logs
        content: |
          [View Full System Logs ‚Üí](/config/logs)
          
          Common issues to check:
          - Entity not found errors
          - Integration errors
          - Automation triggers
          - Template errors

      - type: markdown
        title: üîç Troubleshooting Checklist
        content: |
          **If dashboards not showing:**
          - [ ] Check configuration.yaml for errors
          - [ ] Verify YAML files exist in /config/dashboards/
          - [ ] Check System Logs for errors
          - [ ] Try clearing browser cache (Ctrl+Shift+R)
          
          **If entities not available:**
          - [ ] Check integration is connected
          - [ ] Restart integration
          - [ ] Check entity ID matches config
          
          **If automations not triggering:**
          - [ ] Check automation is enabled
          - [ ] Check trigger conditions
          - [ ] Review automation trace
          - [ ] Check last triggered time

      - type: button
        name: View System Logs
        icon: mdi:text-box-search
        tap_action:
          action: navigate
          navigation_path: /config/logs
        
      - type: button
        name: Developer Tools - Services
        icon: mdi:tools
        tap_action:
          action: navigate
          navigation_path: /developer-tools/service
